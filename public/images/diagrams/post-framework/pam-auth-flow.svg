<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="700" viewBox="0 0 1200 700" role="img" aria-label="PAM Authentication Stack Troubleshooting Flow">
  <!-- Background -->
  <rect width="1200" height="700" fill="#0b1020" rx="20"/>

  <!-- Subtle Data Visualization Grid -->
  <defs>
    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
      <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#1e293b" stroke-width="0.5"/>
    </pattern>
    <linearGradient id="failRed" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#7f1d1d" stop-opacity="0.9" />
      <stop offset="100%" stop-color="#450a0a" stop-opacity="0.4" />
    </linearGradient>
    <linearGradient id="passGreen" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" stop-color="#064e3b" stop-opacity="0.9" />
      <stop offset="100%" stop-color="#022c22" stop-opacity="0.4" />
    </linearGradient>
    <marker id="arrowRed" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#ef4444" />
    </marker>
    <marker id="arrowGreen" viewBox="0 0 10 10" refX="9" refY="5" markerWidth="6" markerHeight="6" orient="auto-start-reverse">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#10b981" />
    </marker>
  </defs>

  <!-- Grid overlay -->
  <rect x="50" y="150" width="1100" height="500" fill="url(#grid)" />
  
  <!-- Title -->
  <text x="60" y="80" fill="#f8fafc" font-size="32" font-family="Segoe UI, Inter, Arial, sans-serif" font-weight="bold">PAM Authentication: The system-auth Pitfall</text>
  <text x="60" y="115" fill="#94a3b8" font-size="18" font-family="Segoe UI, Inter, Arial, sans-serif">Why aligning local commands with the SSH auth-stack prevents opaque Access Denials.</text>

  <!-- Initial Request Node -->
  <rect x="450" y="180" width="300" height="60" rx="8" fill="#1e293b" stroke="#64748b" stroke-width="2"/>
  <text x="600" y="215" fill="#f8fafc" font-size="18" font-family="Consolas, monospace" font-weight="bold" text-anchor="middle">$ su - root</text>
  <text x="600" y="235" fill="#94a3b8" font-size="13" font-family="Segoe UI, Inter, Arial, sans-serif" text-anchor="middle">Triggering /etc/pam.d/su</text>

  <!-- Splitting Paths -->
  <path d="M 520 240 L 320 300" fill="none" stroke="#64748b" stroke-width="3" stroke-dasharray="8 4"/>
  <path d="M 680 240 L 880 300" fill="none" stroke="#64748b" stroke-width="3" stroke-dasharray="8 4"/>

  <!-- LEFT SIDE: Broken system-auth -->
  <rect x="120" y="300" width="360" height="280" rx="10" fill="url(#failRed)" stroke="#b91c1c" stroke-width="2"/>
  <text x="300" y="335" fill="#fca5a5" font-size="18" font-family="Segoe UI, Inter, Arial, sans-serif" font-weight="bold" text-anchor="middle">Broken: `system-auth`</text>

  <rect x="140" y="360" width="320" height="40" rx="4" fill="#450a0a" stroke="#7f1d1d" stroke-width="1"/>
  <text x="300" y="385" fill="#f8fafc" font-size="14" font-family="Consolas, monospace" text-anchor="middle">1. pam_env.so</text>

  <rect x="140" y="410" width="320" height="40" rx="4" fill="#7f1d1d" stroke="#ef4444" stroke-width="2"/>
  <text x="300" y="435" fill="#fef2f2" font-size="14" font-family="Consolas, monospace" text-anchor="middle" font-weight="bold">2. pam_fprintd.so (Fails)</text>
  
  <text x="300" y="475" fill="#fca5a5" font-size="13" font-family="Segoe UI, Inter, Arial, sans-serif" text-anchor="middle">Missing hardware / dead dbus service breaks chain</text>
  
  <rect x="140" y="500" width="320" height="40" rx="4" fill="#450a0a" stroke="#7f1d1d" stroke-width="1" opacity="0.4"/>
  <text x="300" y="525" fill="#cbd5e1" font-size="14" font-family="Consolas, monospace" text-anchor="middle">3. pam_unix.so (Skipped)</text>

  <path d="M 300 580 L 300 620" fill="none" stroke="#ef4444" stroke-width="5" marker-end="url(#arrowRed)"/>
  <rect x="140" y="630" width="320" height="40" rx="6" fill="#1e1b4b" stroke="#ef4444" stroke-width="1"/>
  <text x="300" y="655" fill="#ef4444" font-size="15" font-family="Consolas, monospace" font-weight="bold" text-anchor="middle">"Permission Denied"</text>


  <!-- RIGHT SIDE: Reliable password-auth -->
  <rect x="720" y="300" width="360" height="280" rx="10" fill="url(#passGreen)" stroke="#059669" stroke-width="2"/>
  <text x="900" y="335" fill="#6ee7b7" font-size="18" font-family="Segoe UI, Inter, Arial, sans-serif" font-weight="bold" text-anchor="middle">Fixed: `password-auth`</text>

  <rect x="740" y="360" width="320" height="40" rx="4" fill="#022c22" stroke="#064e3b" stroke-width="1"/>
  <text x="900" y="385" fill="#f8fafc" font-size="14" font-family="Consolas, monospace" text-anchor="middle">1. pam_env.so</text>

  <rect x="740" y="410" width="320" height="40" rx="4" fill="#065f46" stroke="#10b981" stroke-width="2"/>
  <text x="900" y="435" fill="#f8fafc" font-size="14" font-family="Consolas, monospace" font-weight="bold" text-anchor="middle">2. pam_unix.so (Passes)</text>

  <rect x="740" y="460" width="320" height="40" rx="4" fill="#065f46" stroke="#10b981" stroke-width="2"/>
  <text x="900" y="485" fill="#f8fafc" font-size="14" font-family="Consolas, monospace" font-weight="bold" text-anchor="middle">3. pam_sss.so (Passes)</text>
  
  <text x="900" y="530" fill="#a7f3d0" font-size="13" font-family="Segoe UI, Inter, Arial, sans-serif" text-anchor="middle">Validates cleanly against AD / SSSD</text>

  <path d="M 900 580 L 900 620" fill="none" stroke="#10b981" stroke-width="5" marker-end="url(#arrowGreen)"/>
  <rect x="740" y="630" width="320" height="40" rx="6" fill="#1e1b4b" stroke="#10b981" stroke-width="1"/>
  <text x="900" y="655" fill="#10b981" font-size="15" font-family="Consolas, monospace" font-weight="bold" text-anchor="middle">Root Shell Access Granted</text>


</svg>